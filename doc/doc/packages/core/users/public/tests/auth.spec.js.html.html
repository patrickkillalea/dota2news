<!DOCTYPE html>
<html>
<head>
  <title>auth.spec.js.html</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../", thisFile = "doc/packages/core/users/public/tests/auth.spec.js.html", defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>auth.spec.js.html</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>auth.spec.js<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">media=</span><span class="s">&quot;all&quot;</span> <span class="na">href=</span><span class="s">&quot;../../../../../doc-style.css&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../../../../doc-filelist.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">relativeDir</span> <span class="o">=</span> <span class="s2">&quot;../../../../../&quot;</span><span class="p">,</span> <span class="nx">thisFile</span> <span class="o">=</span> <span class="s2">&quot;packages/core/users/public/tests/auth.spec.js&quot;</span><span class="p">,</span> <span class="nx">defaultSidebar</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../../../../doc-script.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;sidebar_wrapper&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;sidebar_switch&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;tree&quot;</span><span class="nt">&gt;</span>Files<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;headings&quot;</span><span class="nt">&gt;</span>Headings<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;tree&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;headings&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;sidebar-toggle&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">&quot;background highlight&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;table</span> <span class="na">cellpadding=</span><span class="s">&quot;0&quot;</span> <span class="na">cellspacing=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;docs&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h1&gt;</span>auth.spec.js<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;code highlight&quot;</span><span class="nt">&gt;&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;docs&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pilwrap&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pilcrow&quot;</span> <span class="na">href=</span><span class="s">&quot;#section-1&quot;</span> <span class="na">id=</span><span class="s">&quot;section-1&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;#182;</span><span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;code highlight&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">&quot;highlight&quot;</span><span class="nt">&gt;&lt;pre&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;s1&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;#39;</span>use strict<span class="ni">&amp;#39;</span><span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>;<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>(<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;kd&quot;</span><span class="nt">&gt;</span>function<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>()<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>{<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;/pre&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;docs&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pilwrap&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pilcrow&quot;</span> <span class="na">href=</span><span class="s">&quot;#section-2&quot;</span> <span class="na">id=</span><span class="s">&quot;section-2&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;#182;</span><span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;p&gt;</span>Login Controller Spec<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;dox&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;summary&quot;</span><span class="nt">&gt;&lt;p&gt;</span>describe(&#39;MEAN controllers&#39;, function() {
describe(&#39;LoginCtrl&#39;, function() {
beforeEach(function() {
jasmine.addMatchers({
toEqualData: function() {
return {
compare: function(actual, expected) {
return {
pass: angular.equals(actual, expected)
};
}
};
}
});
});<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;body&quot;</span><span class="nt">&gt;&lt;p&gt;</span>beforeEach(function() {
module(&#39;mean&#39;);
module(&#39;mean.system&#39;);
module(&#39;mean.users&#39;);
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>var LoginCtrl,
scope,
$rootScope,
$httpBackend,
$location;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>beforeEach(inject(function($controller, <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>, <span class="nt">&lt;em&gt;</span>$location<span class="nt">&lt;/em&gt;</span>, <span class="nt">&lt;em&gt;</span>$httpBackend<span class="nt">&lt;/em&gt;</span>) {<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>scope = <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>.$new();
$rootScope = <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>LoginCtrl = $controller(&#39;LoginCtrl&#39;, {
$scope: scope,
$rootScope: <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>$httpBackend = <span class="nt">&lt;em&gt;</span>$httpBackend<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>$location = <span class="nt">&lt;em&gt;</span>$location<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>}));<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>afterEach(function() {
$httpBackend.verifyNoOutstandingExpectation();
$httpBackend.verifyNoOutstandingRequest();
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>it(&#39;should login with a correct user and password&#39;, function() {<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>spyOn($rootScope, &#39;$emit&#39;);
// test expected GET request
$httpBackend.when(&#39;POST&#39;, &#39;/api/login&#39;).respond(200, {
user: &#39;Fred&#39;
});
scope.login();
$httpBackend.flush();
// test scope value
expect($rootScope.user).toEqual(&#39;Fred&#39;);
expect($rootScope.$emit).toHaveBeenCalledWith(&#39;loggedin&#39;);
expect($location.url()).toEqual(&#39;/&#39;);
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>it(&#39;should fail to log in &#39;, function() {
$httpBackend.expectPOST(&#39;/api/login&#39;).respond(400, &#39;Authentication failed&#39;);
scope.login();
$httpBackend.flush();
// test scope value
expect(scope.loginerror).toEqual(&#39;Authentication failed.&#39;);<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>});
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>describe(&#39;RegisterCtrl&#39;, function() {
beforeEach(function() {
jasmine.addMatchers({
toEqualData: function() {
return {
compare: function(actual, expected) {
return {
pass: angular.equals(actual, expected)
};
}
};
}
});
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>beforeEach(function() {
module(&#39;mean&#39;);
module(&#39;mean.system&#39;);
module(&#39;mean.users&#39;);
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>var RegisterCtrl,
scope,
$rootScope,
$httpBackend,
$location;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>beforeEach(inject(function($controller, <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>, <span class="nt">&lt;em&gt;</span>$location<span class="nt">&lt;/em&gt;</span>, <span class="nt">&lt;em&gt;</span>$httpBackend<span class="nt">&lt;/em&gt;</span>) {<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>scope = <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>.$new();
$rootScope = <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>RegisterCtrl = $controller(&#39;RegisterCtrl&#39;, {
$scope: scope,
$rootScope: <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>$httpBackend = <span class="nt">&lt;em&gt;</span>$httpBackend<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>$location = <span class="nt">&lt;em&gt;</span>$location<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>}));<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>afterEach(function() {
$httpBackend.verifyNoOutstandingExpectation();
$httpBackend.verifyNoOutstandingRequest();
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>it(&#39;should register with correct data&#39;, function() {<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>spyOn($rootScope, &#39;$emit&#39;);
// test expected GET request
scope.user.name = &#39;Fred&#39;;
$httpBackend.when(&#39;POST&#39;, &#39;/api/register&#39;).respond(200, &#39;Fred&#39;);
scope.register();
$httpBackend.flush();
// test scope value
expect($rootScope.user.name).toBe(&#39;Fred&#39;);
expect(scope.registerError).toEqual(0);
expect($rootScope.$emit).toHaveBeenCalledWith(&#39;loggedin&#39;);
expect($location.url()).toBe(&#39;/&#39;);
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>it(&#39;should fail to register with duplicate Username&#39;, function() {
$httpBackend.when(&#39;POST&#39;, &#39;/api/register&#39;).respond(400, &#39;Username already taken&#39;);
scope.register();
$httpBackend.flush();
// test scope value
expect(scope.usernameError).toBe(&#39;Username already taken&#39;);
expect(scope.registerError).toBe(null);
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>it(&#39;should fail to register with non-matching passwords&#39;, function() {
$httpBackend.when(&#39;POST&#39;, &#39;/api/register&#39;).respond(400, &#39;Password mismatch&#39;);
scope.register();
$httpBackend.flush();
// test scope value
expect(scope.usernameError).toBe(null);
expect(scope.registerError).toBe(&#39;Password mismatch&#39;);
});
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>describe(&#39;ForgotPasswordCtrl&#39;, function() {
beforeEach(function() {
jasmine.addMatchers({
toEqualData: function() {
return {
compare: function(actual, expected) {
return {
pass: angular.equals(actual, expected)
};
}
};
}
});
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>beforeEach(function() {
module(&#39;mean&#39;);
module(&#39;mean.system&#39;);
module(&#39;mean.users&#39;);
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>var ForgotPasswordCtrl,
scope,
$rootScope,
$httpBackend ;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>beforeEach(inject(function($controller, <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>, <span class="nt">&lt;em&gt;</span>$httpBackend<span class="nt">&lt;/em&gt;</span>) {<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>scope = <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>.$new();
$rootScope = <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>ForgotPasswordCtrl = $controller(&#39;ForgotPasswordCtrl&#39;, {
$scope: scope,
$rootScope: <span class="nt">&lt;em&gt;</span>$rootScope<span class="nt">&lt;/em&gt;</span>
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>$httpBackend = <span class="nt">&lt;em&gt;</span>$httpBackend<span class="nt">&lt;/em&gt;</span>;<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>}));<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>afterEach(function() {
$httpBackend.verifyNoOutstandingExpectation();
$httpBackend.verifyNoOutstandingRequest();
});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>it(&#39;should display success response on success&#39;, function() {
scope.user.email = &#39;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;mailto:&lt;a href=&#39;</span><span class="na">mailto:test</span><span class="err">@</span><span class="na">test</span><span class="err">.</span><span class="na">com</span><span class="err">&#39;</span><span class="nt">&gt;</span>test@test.com<span class="nt">&lt;/a&gt;</span>&#39;&gt;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;mailto:test@test.com&#39;</span><span class="nt">&gt;</span>test@test.com<span class="nt">&lt;/a&gt;&lt;/a&gt;</span>&#39;;
$httpBackend.when(&#39;POST&#39;, &#39;/api/forgot-password&#39;).respond(200,&#39;Mail successfully sent&#39;);
scope.forgotpassword();
$httpBackend.flush();<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>expect(scope.response).toEqual(&#39;Mail successfully sent&#39;);<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>});
it(&#39;should display error response on failure&#39;, function() {
scope.user.email = &#39;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;mailto:&lt;a href=&#39;</span><span class="na">mailto:test</span><span class="err">@</span><span class="na">test</span><span class="err">.</span><span class="na">com</span><span class="err">&#39;</span><span class="nt">&gt;</span>test@test.com<span class="nt">&lt;/a&gt;</span>&#39;&gt;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;mailto:test@test.com&#39;</span><span class="nt">&gt;</span>test@test.com<span class="nt">&lt;/a&gt;&lt;/a&gt;</span>&#39;;
$httpBackend.when(&#39;POST&#39;, &#39;/api/forgot-password&#39;).respond(400,&#39;User does not exist&#39;);
scope.forgotpassword();
$httpBackend.flush();<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>expect(scope.response).toEqual(&#39;User does not exist&#39;);<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>});<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>});
});  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">&quot;code highlight&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">&quot;highlight&quot;</span><span class="nt">&gt;&lt;pre&gt;</span>


<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>}());<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/pre&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
